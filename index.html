<?php
// index.php ‚Äî –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞ ¬´–û—Å–ª—ñ–ø–ª–µ–Ω–Ω—è –í–∞—Å–∏–ª—å–∫–∞¬ª
// vasylko.terebovlia.info/detective/

$BASE = 'https://vasylko.terebovlia.info/detective';

// –ß–∏—Ç–∞—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–æ–∫–∞–∑—É –≥—Ä–∞–≤—Ü—é –ø—ñ—Å–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
$stats_file = __DIR__ . '/stats.json';
$stats = array('total' => 0, 'ranks' => array(
    'legend'=>0,'expert'=>0,'veteran'=>0,'student'=>0,'novice'=>0
), 'scores_sum' => 0);
if (file_exists($stats_file)) {
    $raw = file_get_contents($stats_file);
    $loaded = json_decode($raw, true);
    if (is_array($loaded)) $stats = $loaded;
}
$stats_json = json_encode($stats);
?><!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–û—Å–ª—ñ–ø–ª–µ–Ω–Ω—è –í–∞—Å–∏–ª—å–∫–∞ ‚Äî –î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞</title>
<meta property="og:type"        content="website">
<meta property="og:url"         content="<?php echo $BASE; ?>/index.php">
<meta property="og:title"       content="–û—Å–ª—ñ–ø–ª–µ–Ω–Ω—è –í–∞—Å–∏–ª—å–∫–∞ ‚Äî –î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞">
<meta property="og:description" content="–ì—Ä—É–¥–µ–Ω—å 1097 —Ä. –•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è–º –∫–Ω—è–∑—è –í–∞—Å–∏–ª—å–∫–∞ –¢–µ—Ä–µ–±–æ–≤–ª—å—Å—å–∫–æ–≥–æ? –†–æ–∑–≥–∞–¥–∞–π –∑–ª–æ—á–∏–Ω XI —Å—Ç. ‚Äî 5 –∑–∞–ø–∏—Ç–∞–Ω—å, 700 –æ—á–æ–∫ –º–∞–∫—Å–∏–º—É–º.">
<meta property="og:image"       content="<?php echo $BASE; ?>/detective-preview-main.jpg">
<meta property="og:image:width"  content="1200">
<meta property="og:image:height" content="630">
<meta property="og:locale"      content="uk_UA">
<meta property="og:site_name"   content="–¢–µ—Ä–µ–±–æ–≤–ª—è.info">
<meta name="twitter:card"       content="summary_large_image">
<meta name="twitter:title"      content="–û—Å–ª—ñ–ø–ª–µ–Ω–Ω—è –í–∞—Å–∏–ª—å–∫–∞ ‚Äî –î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞">
<meta name="twitter:description"content="–•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è–º –í–∞—Å–∏–ª—å–∫–∞ —É 1097 —Ä.? –ü—Ä–æ–π–¥–∏ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—É –≥—Ä—É.">
<meta name="twitter:image"      content="<?php echo $BASE; ?>/detective-preview-main.jpg">
<meta name="description"        content="–ì—Ä—É–¥–µ–Ω—å 1097 —Ä. –•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è–º –∫–Ω—è–∑—è –í–∞—Å–∏–ª—å–∫–∞ –¢–µ—Ä–µ–±–æ–≤–ª—å—Å—å–∫–æ–≥–æ? –†–æ–∑–≥–∞–¥–∞–π –∑–ª–æ—á–∏–Ω XI —Å—Ç. —É –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ñ–π –≥—Ä—ñ.">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ===== –ó–ú–Ü–ù–ù–Ü ===== */
:root{
  --bg:#0f0c07;--surface:#1a1510;--surface2:#221d14;
  --gold:#c9a84c;--gold-l:#e8cb7a;--gold-d:#9a6f2a;
  --red:#c0392b;--green:#27ae60;
  --text:#f0e8d0;--muted:rgba(240,232,208,0.5);
  --border:rgba(201,168,76,0.18);
}
*{margin:0;padding:0;box-sizing:border-box;}
/* LIGHT THEME */
body.light{
  --bg:#f5f0e8;--surface:#fffdf7;--surface2:#f0ead8;
  --gold:#8a6010;--gold-l:#a07818;--gold-d:#6a4808;
  --red:#9b2335;--green:#1a7040;
  --text:#1a1208;--muted:rgba(26,18,8,0.55);
  --border:rgba(138,96,16,0.22);
  background-image:radial-gradient(ellipse 60% 40% at 50% 0%,rgba(180,60,40,0.07) 0%,transparent 60%);
}
/* THEME TOGGLE */
.theme-toggle{position:fixed;top:14px;right:16px;z-index:999;
  display:flex;align-items:center;gap:8px;
  background:var(--surface2);border:1px solid var(--border);
  padding:6px 12px;cursor:pointer;font-family:'Raleway',sans-serif;
  font-size:.72rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;
  color:var(--gold);transition:all .25s;}
.theme-toggle:hover{border-color:var(--gold);}
.theme-toggle .icon{font-size:1rem;transition:transform .3s;}
body.light .theme-toggle .icon{transform:rotate(180deg);}
/* START BLOCK */
.start-block{max-width:800px;margin:0 auto;padding:0 1.5rem 2rem;}
.start-card{background:var(--surface);border:1px solid var(--border);
            border-left:3px solid var(--gold);padding:1.6rem 1.8rem;margin-bottom:1rem;}
.start-card p{font-size:1.05rem;line-height:1.8;color:var(--muted);}
.start-card p strong{color:var(--text);}
.start-share-wrap{margin-top:1.4rem;padding-top:1.2rem;border-top:1px solid var(--border);}
.start-share-lbl{font-size:.68rem;font-weight:700;letter-spacing:.18em;text-transform:uppercase;color:var(--muted);margin-bottom:.75rem;text-align:center;}
.start-share{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;}
.start-share .sbtn{justify-content:center;width:100%;padding:.6em .5em;}
@media(max-width:540px){.start-share{grid-template-columns:repeat(2,1fr);}}
.btn-start{display:block;width:100%;padding:1em 1.5em;background:var(--gold);color:#1a130a;
           font-family:'Raleway',sans-serif;font-size:1.1rem;font-weight:700;
           letter-spacing:.1em;text-transform:uppercase;border:none;cursor:pointer;
           transition:background .2s;margin-bottom:1rem;}
.btn-start:hover{background:var(--gold-l);}
body{background:var(--bg);color:var(--text);font-family:'Raleway',sans-serif;min-height:100vh;
     background-image:radial-gradient(ellipse 60% 40% at 50% 0%,rgba(139,26,26,0.12) 0%,transparent 60%);}

/* ===== –®–ê–ü–ö–ê ===== */
.header{background:linear-gradient(180deg,rgba(139,26,26,0.3) 0%,transparent 100%);
        padding:2.5rem 1.5rem 1.5rem;text-align:center;border-bottom:1px solid rgba(139,26,26,0.3);}
.header-label{font-size:0.95rem;font-weight:700;letter-spacing:0.25em;text-transform:uppercase;
              color:var(--red);margin-bottom:0.8rem;}
.header h1{font-family:'Playfair Display',serif;font-size:clamp(2.2rem,6vw,3.6rem);
           font-weight:700;line-height:1.2;margin-bottom:0.5rem;}
.header h1 em{font-style:italic;color:var(--gold-l);}
.header-sub{font-size:1.1rem;color:var(--muted);max-width:500px;margin:0 auto;}

/* ===== –ü–†–û–ì–†–ï–° ===== */
.progress-wrap{max-width:1100px;margin:0 auto;padding:1.5rem 1.5rem 0;display:flex;align-items:center;gap:1rem;}
.step-dots{display:flex;gap:0.5rem;}
.step-dot{width:10px;height:10px;border-radius:50%;border:1px solid rgba(201,168,76,0.3);
          background:transparent;transition:all 0.3s;}
.step-dot.done{background:var(--green);border-color:var(--green);}
.step-dot.active{background:var(--gold);border-color:var(--gold);transform:scale(1.3);}
.step-dot.wrong{background:var(--red);border-color:var(--red);}
.progress-label{font-size:0.95rem;color:var(--muted);font-weight:600;letter-spacing:0.08em;text-transform:uppercase;}
.score-badge{margin-left:auto;background:var(--surface2);border:1px solid var(--border);
             padding:0.3em 0.9em;font-size:1rem;font-weight:700;color:var(--gold);}

/* ===== –°–¶–ï–ù–ê ===== */
.scene{max-width:1100px;margin:0 auto;padding:1.5rem;}
.scene-card{background:var(--surface);border:1px solid var(--border);margin-bottom:1rem;animation:fadeIn 0.4s ease;}
.scene-image-placeholder{width:100%;height:180px;background:linear-gradient(135deg,var(--surface2),#0a0806);
                          display:flex;align-items:center;justify-content:center;
                          font-size:5rem;border-bottom:1px solid var(--border);}
.scene-header{padding:1.2rem 1.4rem 0.8rem;border-bottom:1px solid var(--border);}
.scene-date{font-size:0.9rem;font-weight:700;letter-spacing:0.2em;text-transform:uppercase;
            color:var(--red);margin-bottom:0.4rem;}
.scene-title{font-family:'Playfair Display',serif;font-size:1.55rem;font-weight:700;}
.scene-body{padding:1rem 1.4rem 1.2rem;font-size:1.1rem;line-height:1.8;color:var(--text);}
.scene-body em{font-style:italic;color:var(--gold-l);}
.scene-body strong{color:var(--text);}

/* ===== –ü–Ü–î–û–ó–†–Æ–í–ê–ù–Ü ===== */
.suspects-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.85rem;margin-bottom:1rem;}
@media(max-width:600px){.suspects-grid{grid-template-columns:repeat(2,1fr);}}
.suspect{background:var(--surface);border:1px solid var(--border);cursor:pointer;transition:all 0.2s;
         padding:1.2rem;display:flex;flex-direction:column;align-items:center;text-align:center;position:relative;}
.suspect:hover{border-color:var(--gold);background:var(--surface2);transform:translateY(-2px);}
.suspect.selected{border-color:var(--gold);background:rgba(201,168,76,0.08);}
.suspect.is-correct{border-color:var(--green) !important;background:rgba(39,174,96,0.1) !important;pointer-events:none;}
.suspect.is-wrong{border-color:var(--red) !important;background:rgba(192,57,43,0.1) !important;pointer-events:none;}
.suspect.disabled{pointer-events:none;}
.suspect-photo{width:80px;height:80px;border-radius:50%;object-fit:cover;border:2px solid var(--border);margin-bottom:0.7rem;}
.suspect-ph{width:80px;height:80px;border-radius:50%;background:var(--surface2);border:2px solid var(--border);
            display:flex;align-items:center;justify-content:center;font-size:2.2rem;margin-bottom:0.7rem;}
.suspect-name{font-family:'Playfair Display',serif;font-size:1.05rem;font-weight:700;margin-bottom:0.2rem;line-height:1.3;}
.suspect-role{font-size:0.88rem;color:var(--muted);}
.sbadge{position:absolute;top:0.4rem;right:0.4rem;font-size:0.75rem;font-weight:700;
        letter-spacing:0.08em;text-transform:uppercase;padding:0.18em 0.5em;}
.sbadge-g{background:var(--red);color:#fff;}
.sbadge-i{background:var(--surface2);color:var(--muted);border:1px solid var(--border);}

/* ===== –ó–ê–ü–ò–¢–ê–ù–ù–Ø / –§–Ü–î–ë–ï–ö ===== */
.question-box{background:var(--surface2);border:1px solid rgba(201,168,76,0.3);
              padding:1rem 1.4rem;margin-bottom:1rem;border-left:3px solid var(--gold);
              display:flex;align-items:flex-start;justify-content:space-between;gap:.8rem;}
.question-text{font-family:'Playfair Display',serif;font-size:1.2rem;line-height:1.5;flex:1;}
.feedback{padding:1rem 1.4rem;margin-bottom:1rem;display:none;}
.feedback.show{display:block;animation:fadeIn 0.35s ease;}
.feedback.ok{background:rgba(39,174,96,0.1);border:1px solid var(--green);border-left:3px solid var(--green);}
.feedback.bad{background:rgba(192,57,43,0.1);border:1px solid var(--red);border-left:3px solid var(--red);}
.fb-title{font-weight:700;font-size:1rem;margin-bottom:0.35rem;}
.feedback.ok .fb-title{color:var(--green);}
.feedback.bad .fb-title{color:var(--red);}
.fb-text{font-size:0.98rem;line-height:1.65;color:var(--muted);}
.btn-next{display:none;width:100%;padding:0.95em 1.5em;background:var(--gold);color:#1a130a;
          font-family:'Raleway',sans-serif;font-size:1.05rem;font-weight:700;
          letter-spacing:0.08em;text-transform:uppercase;border:none;cursor:pointer;transition:background 0.2s;}
.btn-next:hover{background:var(--gold-l);}
.btn-next.show{display:block;}

/* ===== –ü–Ü–î–ö–ê–ó–ö–ê ===== */
.hint-btn{flex-shrink:0;background:transparent;border:1px solid var(--border);
          color:var(--gold);font-family:'Raleway',sans-serif;font-size:.72rem;font-weight:700;
          letter-spacing:.08em;text-transform:uppercase;padding:.4em .75em;cursor:pointer;
          transition:all .2s;white-space:nowrap;align-self:center;}
.hint-btn:hover:not(:disabled){border-color:var(--gold);background:rgba(201,168,76,0.08);}
.hint-btn:disabled{opacity:.3;cursor:not-allowed;}
.hint-box{background:rgba(201,168,76,0.07);border:1px solid rgba(201,168,76,0.3);
          border-left:3px solid var(--gold-d);padding:.85rem 1rem;margin-bottom:1rem;
          font-size:.93rem;line-height:1.7;color:var(--muted);display:none;animation:fadeIn .3s ease;}
.hint-box.show{display:block;}
.hint-box em{color:var(--gold-l);font-style:normal;}

/* ===== –ê–ù–Ü–ú–ê–¶–Ü–Ø –ü–ï–†–ï–•–û–î–£ ===== */
@keyframes slideIn{from{opacity:0;transform:translateX(48px);}to{opacity:1;transform:translateX(0);}}
@keyframes slideOut{from{opacity:1;transform:translateX(0);}to{opacity:0;transform:translateX(-48px);}}
.scene-entering .scene-card,.scene-entering .question-box,
.scene-entering .hint-box,.scene-entering .suspects-grid{animation:slideIn .38s ease both;}
.scene-exiting{animation:slideOut .22s ease both;pointer-events:none;}

/* ===== –ó–í–£–ö ===== */
.sound-toggle{position:fixed;top:14px;left:16px;z-index:999;
  background:var(--surface2);border:1px solid var(--border);
  padding:7px 12px;cursor:pointer;font-size:.85rem;
  color:var(--gold);transition:all .25s;font-family:'Raleway',sans-serif;
  font-size:.72rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;}
.sound-toggle:hover{border-color:var(--gold);}

/* ===== –í–ï–†–î–ò–ö–¢ ===== */
.verdict{max-width:1100px;margin:0 auto;padding:1.5rem;display:none;animation:fadeIn 0.6s ease;}
.verdict-card{background:var(--surface);border:1px solid var(--border);padding:2rem;text-align:center;}
.verdict-icon{font-size:4rem;margin-bottom:1rem;}
.verdict-title{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,4vw,2.4rem);
               font-weight:700;margin-bottom:0.5rem;}
.verdict-score{font-size:1.25rem;color:var(--gold);letter-spacing:0.08em;margin-bottom:1.5rem;}
.verdict-desc{font-size:1.05rem;line-height:1.8;color:var(--muted);
              max-width:520px;margin:0 auto 1.5rem;text-align:left;}

/* ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===== */
.stats-box{background:var(--surface2);border:1px solid var(--border);border-left:3px solid var(--gold-d);
           padding:1.2rem 1.4rem;margin-bottom:1.5rem;text-align:left;}
.stats-title{font-size:0.78rem;font-weight:700;letter-spacing:0.18em;text-transform:uppercase;
             color:var(--gold);margin-bottom:0.9rem;}
.stats-total{font-size:1.05rem;color:var(--text);margin-bottom:1rem;}
.stats-total span{font-weight:700;color:var(--gold-l);}
.stats-ranks{display:flex;flex-direction:column;gap:0.5rem;}
.stat-row{display:flex;align-items:center;gap:0.7rem;font-size:0.9rem;}
.stat-label{width:160px;color:var(--muted);flex-shrink:0;}
.stat-bar-wrap{flex:1;height:8px;background:rgba(255,255,255,0.06);border-radius:2px;overflow:hidden;}
.stat-bar{height:100%;background:var(--gold-d);border-radius:2px;transition:width 0.8s ease;}
.stat-count{width:36px;text-align:right;color:var(--gold);font-weight:700;flex-shrink:0;}
.stat-pct{width:38px;text-align:right;color:var(--muted);font-size:0.8rem;flex-shrink:0;}

/* ===== –ü–û–®–ò–†–ï–ù–ù–Ø ===== */
.share-wrap{margin-bottom:1.8rem;}
.share-lbl{font-size:0.82rem;font-weight:700;letter-spacing:0.18em;text-transform:uppercase;
           color:var(--muted);margin-bottom:0.7rem;}
.share-preview{background:var(--surface2);border:1px solid var(--border);border-left:3px solid var(--gold-d);
               padding:0.8rem 1rem;margin-bottom:1rem;font-size:0.95rem;line-height:1.7;
               color:var(--muted);font-style:italic;text-align:left;white-space:pre-line;}
.share-btns{display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center;}
.sbtn{display:inline-flex;align-items:center;gap:0.4em;padding:0.55em 1.1em;border:1px solid;
      font-family:'Raleway',sans-serif;font-size:0.88rem;font-weight:700;
      letter-spacing:0.05em;text-transform:uppercase;cursor:pointer;background:transparent;transition:all 0.2s;}
.sbtn-tw{border-color:rgba(29,161,242,0.4);color:rgba(29,161,242,0.8);}
.sbtn-tw:hover{background:rgba(29,161,242,0.1);border-color:rgba(29,161,242,1);}
.sbtn-fb{border-color:rgba(66,103,178,0.4);color:rgba(66,103,178,0.8);}
.sbtn-fb:hover{background:rgba(66,103,178,0.1);border-color:rgba(66,103,178,1);}
.sbtn-tg{border-color:rgba(0,136,204,0.4);color:rgba(0,136,204,0.8);}
.sbtn-tg:hover{background:rgba(0,136,204,0.1);border-color:rgba(0,136,204,1);}
.sbtn-vi{border-color:rgba(122,61,162,0.4);color:rgba(122,61,162,0.8);}
.sbtn-vi:hover{background:rgba(122,61,162,0.1);border-color:rgba(122,61,162,1);}
.sbtn-cp{border-color:var(--border);color:var(--muted);}
.sbtn-cp:hover{border-color:var(--gold);color:var(--gold);}
.sbtn-cp.copied{border-color:var(--green);color:var(--green);}

/* ===== –•–†–û–ù–Ü–ö–ê ===== */
.history-box{background:var(--surface2);border:1px solid var(--border);
             padding:1.2rem 1.4rem;margin-bottom:1.5rem;text-align:left;}
.history-title{font-size:0.78rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;
               color:var(--gold);margin-bottom:0.8rem;}
.history-text{font-size:1rem;line-height:1.8;color:var(--muted);}
.btn-replay{padding:0.75em 2em;background:transparent;color:var(--gold);font-family:'Raleway',sans-serif;
            font-size:0.98rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;
            border:1px solid var(--gold);cursor:pointer;transition:all 0.2s;margin-top:0.5rem;}
.btn-replay:hover{background:var(--gold);color:#1a130a;}

@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* ===== –ú–û–ë–Ü–õ–¨–ù–ò–ô (‚â§600px): +20% ===== */
@media(max-width:600px){
  .header-label{font-size:0.82rem;}
  .header h1{font-size:clamp(1.9rem,8vw,3rem);}
  .header-sub{font-size:0.98rem;}
  .scene-date{font-size:0.82rem;}
  .scene-title{font-size:1.35rem;}
  .scene-body{font-size:1rem;}
  .question-text{font-size:1.08rem;}
  .suspect-name{font-size:0.96rem;}
  .suspect-role{font-size:0.8rem;}
  .fb-title{font-size:0.92rem;}
  .fb-text{font-size:0.9rem;}
  .btn-next{font-size:0.96rem;}
  .verdict-title{font-size:clamp(1.55rem,5vw,2rem);}
  .verdict-score{font-size:1.1rem;}
  .verdict-desc{font-size:0.96rem;}
  .history-text{font-size:0.92rem;}
  .sbtn{font-size:0.8rem;}
  .stats-total{font-size:0.96rem;}
  .stat-row{font-size:0.82rem;}
  .stat-label{width:130px;}
}
</style>
<script type="text/javascript" data-cmp-ab="1" src="https://cdn.consentmanager.net/delivery/autoblocking/75123c3a028c1.js" data-cmp-host="a.delivery.consentmanager.net" data-cmp-cdn="cdn.consentmanager.net" data-cmp-codesrc="16"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-46SFQP5BML"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-46SFQP5BML');</script>
</head>
<body>

<button class="sound-toggle" id="soundBtn" onclick="toggleSound()" title="–ó–≤—É–∫">&#128266; –ó–≤—É–∫</button>
<button class="theme-toggle" onclick="toggleTheme()" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">
  <span class="icon">üåô</span> <span id="theme-lbl">–°–≤—ñ—Ç–ª–∞</span>
</button>

<div class="header">
  <div class="header-label">üîç –î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞ ¬∑ –¢–µ—Ä–µ–±–æ–≤–ª—è, 1097</div>
  <h1>–û—Å–ª—ñ–ø–ª–µ–Ω–Ω—è <em>–í–∞—Å–∏–ª—å–∫–∞</em></h1>
  <p class="header-sub">–ì—Ä—É–¥–µ–Ω—å 1097 —Ä–æ–∫—É. –ü—ñ—Å–ª—è –õ—é–±–µ—Ü—å–∫–æ–≥–æ –∑'—ó–∑–¥—É –∫–Ω—è–∑—å –í–∞—Å–∏–ª—å–∫–æ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ –ø–∞—Å—Ç–∫—É. –•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ –∑–ª–æ—á–∏–Ω–æ–º?</p>
</div>

<div class="start-block" id="startBlock">
  <div class="start-card">
    <p><strong>–ì—Ä—É–¥–µ–Ω—å 1097 —Ä.</strong> –ü—ñ—Å–ª—è –õ—é–±–µ—Ü—å–∫–æ–≥–æ –∑'—ó–∑–¥—É –∫–Ω—è–∑—å –í–∞—Å–∏–ª—å–∫–æ –¢–µ—Ä–µ–±–æ–≤–ª—å—Å—å–∫–∏–π –æ—Ç—Ä–∏–º–∞–≤ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å–≤–æ—ó—Ö –∑–µ–º–µ–ª—å. –ê–ª–µ –¥–æ—Ä–æ–≥–æ—é –¥–æ –¥–æ–º—É –π–æ–≥–æ –∑–∞–º–∞–Ω–∏–ª–∏ —É –ø–∞—Å—Ç–∫—É, —Å—Ö–æ–ø–∏–ª–∏ —ñ –æ—Å–ª—ñ–ø–∏–ª–∏. –•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ —Ü–∏–º –∑–ª–æ—á–∏–Ω–æ–º? –ß–∏—è –±—Ä–µ—Ö–Ω—è –ø–æ–≥—É–±–∏–ª–∞ –∫–Ω—è–∑—è?</p>
    <p style="margin-top:.8rem">5 —Å—Ü–µ–Ω, —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–æ–∫–∞–∑–∏, 700 –æ—á–æ–∫ –º–∞–∫—Å–∏–º—É–º. –†–æ–∑–≥–∞–¥–∞–π –∑–ª–æ—á–∏–Ω XI —Å—Ç.</p>
  </div>
  <button class="btn-start" onclick="startGame()">&#9654; –ü–æ—á–∞—Ç–∏ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è</button>
  <div class="start-share-wrap">
    <div class="start-share-lbl">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –≥—Ä–æ—é</div>
    <div class="start-share" id="startShare">
      <button class="sbtn sbtn-fb" onclick="shareGame('fb')">f Facebook</button>
      <button class="sbtn sbtn-tg" onclick="shareGame('tg')">‚úà Telegram</button>
      <button class="sbtn sbtn-vi" onclick="shareGame('vi')">üì≤ Viber</button>
      <button class="sbtn sbtn-tw" onclick="shareGame('tw')">ùïè Twitter</button>
    </div>
  </div>
  <div style="text-align:center;margin-top:.7rem;display:flex;justify-content:center;gap:1.5rem;">
    <a href="stats.php" style="font-size:.82rem;color:var(--gold);text-decoration:none;font-weight:600;letter-spacing:.06em;opacity:.75;">&#128202; –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞–≤—Ü—ñ–≤</a>
  </div>
</div>
<div class="progress-wrap" id="progressWrap" style="display:none">
  <div class="step-dots" id="stepDots"></div>
  <span class="progress-label" id="progressLabel">–†–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è</span>
  <div class="score-badge" id="scoreBadge">–û—á–∫–∏: 0</div>
</div>
<div class="scene" id="sceneWrap" style="display:none"></div>
<div class="verdict" id="verdictWrap"></div>

<script>
var BASE_URL = '<?php echo $BASE; ?>';

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑ —Å–µ—Ä–≤–µ—Ä–∞ (PHP –ø–µ—Ä–µ–¥–∞—î —É JS)
var SERVER_STATS = <?php echo $stats_json; ?>;

var PH = {
  sv:'sviatopolk.jpg',
  mn:'monomah.jpg',
  vl:'Volodar_Rostyslavych.jpg',
  dv:'David_Ihorovych.jpg',
  vs:'Vasilko_Rostislavich.jpg'
};

var STEPS = [
  {type:'scene', date:'–õ–∏—Å—Ç–æ–ø–∞–¥ 1097 —Ä.', title:'–õ—é–±–µ—Ü—å–∫–∏–π –∑\'—ó–∑–¥', icon:'üè∞',
   body:'<strong>–õ–∏—Å—Ç–æ–ø–∞–¥ 1097 —Ä–æ–∫—É.</strong> –ö–Ω—è–∑—ñ —É–∫–ª–∞–ª–∏ –º–∏—Ä —É –õ—é–±–µ—á—ñ. –í–∞—Å–∏–ª—å–∫–æ –æ—Ç—Ä–∏–º–∞–≤ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∞–≤ –Ω–∞ –¢–µ—Ä–µ–±–æ–≤–ª—é. –ê–ª–µ –≤–∞—Ä—Ç–æ –≤–∏—Ä—É—à–∏—Ç–∏ ‚Äî –¥–æ –Ω—å–æ–≥–æ –ø—Ä–∏–π—à–æ–≤ –ø–æ—Å–ª–∞–Ω–µ—Ü—å –≤—ñ–¥ <strong>–î–∞–≤–∏–¥–∞ –Ü–≥–æ—Ä–µ–≤–∏—á–∞</strong> —ñ–∑ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è–º –∑–∞–≤–µ—Ä–Ω—É—Ç–∏ –¥–æ –ö–∏—î–≤–∞.',
   q:'–•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è–º –¥–æ –ö–∏—î–≤–∞?',
   hint:'–î–∞–≤–∏–¥ –Ü–≥–æ—Ä–µ–≤–∏—á —Å–∞–º –Ω–µ –º–∞–≤ –≤–ª–∞–¥–∏ –∑–∞—Ç—Ä–∏–º–∞—Ç–∏ –í–∞—Å–∏–ª—å–∫–∞ ‚Äî –¥–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –±—É–≤ —Ö—Ç–æ—Å—å –≤–∏—â–∏–π. –•—Ç–æ –±—É–≤ –Ω–∞–π–≤–∏—â–∏–º –∫–Ω—è–∑–µ–º —É –ö–∏—î–≤—ñ?',
   sus:[
     {k:'dv', n:'–î–∞–≤–∏–¥ –Ü–≥–æ—Ä–µ–≤–∏—á', r:'–ö–Ω—è–∑—å –í–æ–ª–∏–Ω—Å—å–∫–∏–π',        e:'üò§',  ph:'dv', ok:false},
     {k:'sp', n:'–°–≤—è—Ç–æ–ø–æ–ª–∫ II',   r:'–í–µ–ª–∏–∫–∏–π –∫–Ω—è–∑—å –ö–∏—ó–≤—Å—å–∫–∏–π', e:'üëë',  ph:'sv', ok:true},
     {k:'tg', n:'–¢—É–≥–æ—Ä–∫–∞–Ω',       r:'–ü–æ–ª–æ–≤–µ—Ü—å–∫–∏–π —Ö–∞–Ω',          e:'üèπ',  ph:null, ok:false},
     {k:'mm', n:'–ú–æ–Ω–æ–º–∞—Ö',        r:'–ü–µ—Ä–µ—è—Å–ª–∞–≤—Å—å–∫–∏–π –∫–Ω—è–∑—å',     e:'‚öîÔ∏è', ph:'mn', ok:false}
   ],
   ck:'sp', pts:150,
   fok:'–í—ñ—Ä–Ω–æ! –ó–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è–º —Å—Ç–æ—ó—Ç—å –°–≤—è—Ç–æ–ø–æ–ª–∫. –î–∞–≤–∏–¥ –ø–µ—Ä–µ–∫–æ–Ω–∞–≤ –π–æ–≥–æ, —â–æ –í–∞—Å–∏–ª—å–∫–æ –∑–º–æ–≤–∏–≤—Å—è –∑ –ú–æ–Ω–æ–º–∞—Ö–æ–º —ñ —Ö–æ—á–µ –∑–∞—Ö–æ–ø–∏—Ç–∏ –ö–∏—ó–≤.',
   fno:'–ù—ñ. –ó–∞ –î–∞–≤–∏–¥–æ–º —Å—Ç–æ—ó—Ç—å –°–≤—è—Ç–æ–ø–æ–ª–∫ ‚Äî –≤–µ–ª–∏–∫–∏–π –∫–Ω—è–∑—å. –î–∞–≤–∏–¥ –ø–µ—Ä–µ–∫–æ–Ω–∞–≤ –π–æ–≥–æ, —â–æ –í–∞—Å–∏–ª—å–∫–æ —Ö–æ—á–µ –∑–∞—Ö–æ–ø–∏—Ç–∏ –ö–∏—ó–≤ —ñ –¢—É—Ä–æ–≤.'},

  {type:'scene', date:'5 –≥—Ä—É–¥–Ω—è 1097 —Ä.', title:'–ü–∞—Å—Ç–∫–∞ —É –í–∏–¥—É–±–∏—á–∞—Ö', icon:'‚õì',
   body:'–í–∞—Å–∏–ª—å–∫–∞ –∑–∞–ø—Ä–æ—Å–∏–ª–∏ –Ω–∞ —ñ–º–µ–Ω–∏–Ω–∏ ‚Äî –≤–∞—Ä—Ç–æ —É–≤—ñ–π—Ç–∏, –¥–≤–µ—Ä—ñ –∑–∞—á–∏–Ω–∏–ª–∏—Å—å. <strong>–í–∞—Ä—Ç–∞ –°–≤—è—Ç–æ–ø–æ–ª–∫–∞ —Å—Ö–æ–ø–∏–ª–∞ –π–æ–≥–æ</strong> —ñ –∑–∞–∫—É–≤–∞–ª–∞. –î–∞–≤–∏–¥ —Ö–æ—Ç—ñ–≤ –Ω–∞–∑–∞–≤–∂–¥–∏ –Ω–µ–π—Ç—Ä–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å—É–ø–µ—Ä–Ω–∏–∫–∞.',
   q:'–Ø–∫—É –±—Ä–µ—Ö–Ω—é –î–∞–≤–∏–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–≤, —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏ –°–≤—è—Ç–æ–ø–æ–ª–∫–∞?',
   hint:'–î–∞–≤–∏–¥ –º–∞–≤ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏ –°–≤—è—Ç–æ–ø–æ–ª–∫–∞, —â–æ –í–∞—Å–∏–ª—å–∫–æ –∑–∞–≥—Ä–æ–∂—É—î —Å–∞–º–µ –π–æ–≥–æ –≤–ª–∞–¥—ñ —ñ –º—ñ—Å—Ç–∞–º. –©–æ –Ω–∞–π–±—ñ–ª—å—à–µ –ª—è–∫–∞—î –≤–µ–ª–∏–∫–æ–≥–æ –∫–Ω—è–∑—è?',
   sus:[
     {k:'a', n:'–í–∞—Å–∏–ª—å–∫–æ –≤–±–∏–≤ –ø–æ—Å–ª–∞–Ω—Ü—è',              r:'–û—Å–æ–±–∏—Å—Ç–∞ –æ–±—Ä–∞–∑–∞',  e:'üó°', ph:null, ok:false},
     {k:'b', n:'–í–∞—Å–∏–ª—å–∫–æ —Ö–æ—á–µ –∑–∞—Ö–æ–ø–∏—Ç–∏ –ö–∏—ó–≤ —ñ –¢—É—Ä–æ–≤', r:'–ó–º–æ–≤–∞ –ø—Ä–æ—Ç–∏ —Ç—Ä–æ–Ω—É', e:'üëë', ph:null, ok:true},
     {k:'c', n:'–í–∞—Å–∏–ª—å–∫–æ —É–∫–ª–∞–≤ —Å–æ—é–∑ –∑ –ø–æ–ª—è–∫–∞–º–∏',      r:'–î–µ—Ä–∂–∞–≤–Ω–∞ –∑—Ä–∞–¥–∞',    e:'ü§ù', ph:null, ok:false},
     {k:'d', n:'–í–∞—Å–∏–ª—å–∫–æ —Ö–æ—á–µ –æ—Ç—Ä—É—ó—Ç–∏ –°–≤—è—Ç–æ–ø–æ–ª–∫–∞',    r:'–ó–∞–º–∞—Ö',             e:'‚ò†', ph:null, ok:false}
   ],
   ck:'b', pts:100,
   fok:'–°–∞–º–µ —Ç–∞–∫. –î–∞–≤–∏–¥ —Å–∫–∞–∑–∞–≤: –í–∞—Å–∏–ª—å–∫–æ –∑–º–æ–≤–∏–≤—Å—è –∑ –ú–æ–Ω–æ–º–∞—Ö–æ–º —ñ —Ö–æ—á–µ –∑–∞—Ö–æ–ø–∏—Ç–∏ –ö–∏—ó–≤ —ñ –¢—É—Ä–æ–≤. –ë—Ä–µ—Ö–Ω—è —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞.',
   fno:'–ù—ñ. –î–∞–≤–∏–¥ –ø–µ—Ä–µ–∫–æ–Ω–∞–≤ –°–≤—è—Ç–æ–ø–æ–ª–∫–∞, —â–æ –í–∞—Å–∏–ª—å–∫–æ —Ö–æ—á–µ –∑–∞—Ö–æ–ø–∏—Ç–∏ –ö–∏—ó–≤ —ñ –¢—É—Ä–æ–≤.'},

  {type:'scene', date:'–ì—Ä—É–¥–µ–Ω—å 1097 —Ä.', title:'–ó–ª–æ—á–∏–Ω', icon:'üî™',
   body:'–í–∞—Å–∏–ª—å–∫–∞ –ø–µ—Ä–µ–≤–µ–∑–ª–∏ –¥–æ –ó–≤–µ–Ω–∏–≥–æ—Ä–æ–¥–∞. –î–∞–≤–∏–¥ –Ω–∞–¥—ñ—Å–ª–∞–≤ —Å–≤–æ—ó—Ö –ª—é–¥–µ–π. <strong>–î–≤–∞ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ –∑–¥—ñ–π—Å–Ω–∏–ª–∏ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è.</strong> –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –í–∞—Å–∏–ª—å–∫–∞ —Ç—Ä–∏–º–∞–ª–∏ –ø—ñ–¥ –≤–∞—Ä—Ç–æ—é.',
   q:'–•—Ç–æ –æ—Å–æ–±–∏—Å—Ç–æ –Ω–∞–∫–∞–∑–∞–≤ –ø—Ä–æ–≤–µ—Å—Ç–∏ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è?',
   hint:'–°–≤—è—Ç–æ–ø–æ–ª–∫ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–≤ –∞—Ä–µ—à—Ç, –∞–ª–µ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è ‚Äî –æ–∫—Ä–µ–º–∏–π –∫—Ä–æ–∫. –•—Ç–æ –º–∞–≤ –Ω–∞–π–±—ñ–ª—å—à–µ –∑–∏—Å–∫—É –∑ —Ç–æ–≥–æ, —â–æ–± –í–∞—Å–∏–ª—å–∫–æ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–º—ñ–≥ –≤–æ—é–≤–∞—Ç–∏?',
   sus:[
     {k:'sp', n:'–°–≤—è—Ç–æ–ø–æ–ª–∫ II',   r:'–ù–∞–∫–∞–∑–∞–≤ –∞—Ä–µ—à—Ç',        e:'üëë',  ph:'sv', ok:false},
     {k:'dv', n:'–î–∞–≤–∏–¥ –Ü–≥–æ—Ä–µ–≤–∏—á', r:'–û—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä –∑–ª–æ—á–∏–Ω—É',  e:'üò§',  ph:'dv', ok:true},
     {k:'mm', n:'–ú–æ–Ω–æ–º–∞—Ö',        r:'–ü–µ—Ä–µ—è—Å–ª–∞–≤—Å—å–∫–∏–π –∫–Ω—è–∑—å', e:'‚öîÔ∏è', ph:'mn', ok:false},
     {k:'vl', n:'–í–æ–ª–æ–¥–∞—Ä',        r:'–ë—Ä–∞—Ç –í–∞—Å–∏–ª—å–∫–∞',        e:'üõ°',  ph:'vl', ok:false}
   ],
   ck:'dv', pts:150,
   fok:'–ü—Ä–∞–≤–∏–ª—å–Ω–æ. –î–∞–≤–∏–¥ –Ü–≥–æ—Ä–µ–≤–∏—á –æ—Å–æ–±–∏—Å—Ç–æ –Ω–∞–∫–∞–∑–∞–≤ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è ‚Äî –≤—ñ–Ω —Ö–æ—Ç—ñ–≤ –∑–∞–≤–æ–ª–æ–¥—ñ—Ç–∏ –∑–µ–º–ª—è–º–∏ –í–∞—Å–∏–ª—å–∫–∞.',
   fno:'–ù—ñ. –•–æ—á–∞ –°–≤—è—Ç–æ–ø–æ–ª–∫ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–≤ –∞—Ä–µ—à—Ç, —Å–∞–º–µ –î–∞–≤–∏–¥ –Ω–∞–∫–∞–∑–∞–≤ –æ—Å–ª—ñ–ø–ª–µ–Ω–Ω—è.'},

  {type:'scene', date:'1098‚Äì1099 —Ä—Ä.', title:'–í—ñ–¥–ø–ª–∞—Ç–∞', icon:'‚öîÔ∏è',
   body:'–ú–æ–Ω–æ–º–∞—Ö –¥—ñ–∑–Ω–∞–≤—à–∏—Å—å –∑–∞–ø–ª–∞–∫–∞–≤ —ñ —Å–∫–ª–∏–∫–∞–≤ –∫–Ω—è–∑—ñ–≤. –ë—Ä–∞—Ç –í–∞—Å–∏–ª—å–∫–∞ –í–æ–ª–æ–¥–∞—Ä –≤–∏–∑–≤–æ–ª–∏–≤ –π–æ–≥–æ. –£ 1099 —Ä. –Ω–∞ <strong>–†–æ–∂–Ω–æ–º—É –ø–æ–ª—ñ</strong> –í–∞—Å–∏–ª—å–∫–æ —ñ –í–æ–ª–æ–¥–∞—Ä —Ä–æ–∑–±–∏–ª–∏ –∞—Ä–º—ñ—é –°–≤—è—Ç–æ–ø–æ–ª–∫–∞.',
   q:'–•—Ç–æ –∑—Ä–µ—à—Ç–æ—é –∑–∞—Å—É–¥–∏–≤ –î–∞–≤–∏–¥–∞ –∑–∞ –∑–ª–æ—á–∏–Ω?',
   hint:'–ù–µ –æ–¥–Ω–∞ –ª—é–¥–∏–Ω–∞, –∞ –≥—Ä—É–ø–∞. –ü—ñ—Å–ª—è –∑–ª–æ—á–∏–Ω—É –∫–Ω—è–∑—ñ –Ω–µ –º–æ–≥–ª–∏ –º–æ–≤—á–∞—Ç–∏ ‚Äî —Ö—Ç–æ—Å—å —Å–∫–ª–∏–∫–∞–≤ —ó—Ö –Ω–∞ –∑\'—ó–∑–¥. –•—Ç–æ —Ç–æ–¥—ñ –±—É–≤ –º–æ—Ä–∞–ª—å–Ω–∏–º –ª—ñ–¥–µ—Ä–æ–º —Å–µ—Ä–µ–¥ –∫–Ω—è–∑—ñ–≤?',
   sus:[
     {k:'mm', n:'–ú–æ–Ω–æ–º–∞—Ö —ñ –∫–Ω—è–∑—ñ', r:'–ó—ñ–±—Ä–∞–ª–∏ –∑\'—ó–∑–¥ –ø—Ä–æ—Ç–∏ –î–∞–≤–∏–¥–∞', e:'‚öîÔ∏è', ph:'mn', ok:true},
     {k:'pp', n:'–ü–∞–ø–∞ –†–∏–º—Å—å–∫–∏–π',   r:'–î—É—Ö–æ–≤–Ω–∞ –≤–ª–∞–¥–∞',               e:'‚úù',  ph:null, ok:false},
     {k:'sp', n:'–°–≤—è—Ç–æ–ø–æ–ª–∫',       r:'–í–µ–ª–∏–∫–∏–π –∫–Ω—è–∑—å',               e:'üëë', ph:'sv', ok:false},
     {k:'vs', n:'–í–∞—Å–∏–ª—å–∫–æ —Å–∞–º',    r:'–ü–µ—Ä–µ–º–æ–∂–µ—Ü—å –Ω–∞ –ø–æ–ª—ñ –±–æ—é',      e:'üõ°', ph:'vs', ok:false}
   ],
   ck:'mm', pts:100,
   fok:'–í—ñ—Ä–Ω–æ. –ú–æ–Ω–æ–º–∞—Ö –æ–±\'—î–¥–Ω–∞–≤ –∫–Ω—è–∑—ñ–≤. –ó\'—ó–∑–¥ 1100 —Ä. –≤ –£–≤–µ—Ç–∏—á–∞—Ö –ø–æ–∑–±–∞–≤–∏–≤ –î–∞–≤–∏–¥–∞ –í–æ–ª–∏–Ω—ñ.',
   fno:'–ù—ñ. –°–∞–º–µ –ú–æ–Ω–æ–º–∞—Ö –∑—ñ–±—Ä–∞–≤ –∫–Ω—è–∑—ñ–≤. –ó\'—ó–∑–¥ –≤ –£–≤–µ—Ç–∏—á–∞—Ö 1100 —Ä. –ø–æ–∑–±–∞–≤–∏–≤ –î–∞–≤–∏–¥–∞ –í–æ–ª–∏–Ω—ñ.'},

  {type:'verdict',
   q:'–§—ñ–Ω–∞–ª—å–Ω–∏–π –≤–µ—Ä–¥–∏–∫—Ç: —Ö—Ç–æ –ì–û–õ–û–í–ù–ò–ô –≤–∏–Ω—É–≤–∞—Ç–µ—Ü—å?',
   hint:'–ó–ª–æ—á–∏–Ω –º–∞–≤ –¥–≤–æ—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤ ‚Äî –æ–¥–∏–Ω –≤–∏–≥–∞–¥–∞–≤ –±—Ä–µ—Ö–Ω—é —ñ –Ω–∞–∫–∞–∑–∞–≤ –∑–ª–æ—á–∏–Ω, —ñ–Ω—à–∏–π –¥–∞–≤ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π –¥–æ–∑–≤—ñ–ª —ñ –º—ñ—Å—Ü–µ –¥–ª—è –∞—Ä–µ—à—Ç—É. –ë–µ–∑ –∫–æ–≥–æ—Å—å —ñ–∑ –Ω–∏—Ö –∑–ª–æ—á–∏–Ω –Ω–µ –≤—ñ–¥–±—É–≤—Å—è –±.',
   sus:[
     {k:'sp', n:'–°–≤—è—Ç–æ–ø–æ–ª–∫ II',   r:'–í–µ–ª–∏–∫–∏–π –∫–Ω—è–∑—å –ö–∏—ó–≤—Å—å–∫–∏–π', e:'üëë', ph:'sv', ok:true},
     {k:'dv', n:'–î–∞–≤–∏–¥ –Ü–≥–æ—Ä–µ–≤–∏—á', r:'–ö–Ω—è–∑—å –í–æ–ª–∏–Ω—Å—å–∫–∏–π',        e:'üò§', ph:'dv', ok:true},
     {k:'mm', n:'–ú–æ–Ω–æ–º–∞—Ö',        r:'–ü–µ—Ä–µ—è—Å–ª–∞–≤—Å—å–∫–∏–π –∫–Ω—è–∑—å',    e:'‚öîÔ∏è',ph:'mn', ok:false},
     {k:'vl', n:'–í–æ–ª–æ–¥–∞—Ä',        r:'–ë—Ä–∞—Ç –í–∞—Å–∏–ª—å–∫–∞',           e:'üõ°', ph:'vl', ok:false}
   ],
   cks:['sp','dv'], pts:200,
   fok:'–¢–æ—á–Ω–æ. –û–±–∏–¥–≤–∞: –î–∞–≤–∏–¥ –≤–∏–≥–∞–¥–∞–≤ –±—Ä–µ—Ö–Ω—é —ñ –Ω–∞–∫–∞–∑–∞–≤ –∑–ª–æ—á–∏–Ω. –°–≤—è—Ç–æ–ø–æ–ª–∫ –¥–∞–≤ –¥–æ–∑–≤—ñ–ª —ñ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–≤ –∞—Ä–µ—à—Ç.',
   fpart:'–ß–∞—Å—Ç–∫–æ–≤–æ. –û–±–∏–¥–≤–∞ –≤–∏–Ω–Ω—ñ: –î–∞–≤–∏–¥ ‚Äî –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä, –°–≤—è—Ç–æ–ø–æ–ª–∫ ‚Äî —Å–ø—ñ–≤—É—á–∞—Å–Ω–∏–∫.',
   fno:'–ù—ñ. –î–∞–≤–∏–¥ –≤–∏–≥–∞–¥–∞–≤ –±—Ä–µ—Ö–Ω—é —ñ –Ω–∞–∫–∞–∑–∞–≤ –∑–ª–æ—á–∏–Ω. –°–≤—è—Ç–æ–ø–æ–ª–∫ –¥–∞–≤ –¥–æ–∑–≤—ñ–ª —ñ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–≤ –∞—Ä–µ—à—Ç.'}
];

var cur = 0, score = 0, results = [];
var SD = {text:'', url:''};
var hintUsed = false;   // –æ–¥–Ω–∞ –ø—ñ–¥–∫–∞–∑–∫–∞ –Ω–∞ –≤—Å—é –≥—Ä—É
var soundOn  = true;    // –∑–≤—É–∫ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–π –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

// ===== –ó–í–£–ö (Web Audio API) =====
var AC = null;
function getAC(){ if(!AC) try{ AC = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){} return AC; }

function playTone(freq, dur, type, vol, startFade) {
  if(!soundOn) return;
  var ac = getAC(); if(!ac) return;
  var o = ac.createOscillator();
  var g = ac.createGain();
  o.connect(g); g.connect(ac.destination);
  o.type = type||'sine'; o.frequency.value = freq;
  g.gain.setValueAtTime(vol||0.18, ac.currentTime);
  if(startFade) g.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + dur);
  o.start(ac.currentTime); o.stop(ac.currentTime + dur);
}
function playCorrect() {
  // –ê–∫–æ—Ä–¥ –ø–µ—Ä–µ–º–æ–≥–∏: C5 ‚Üí E5 ‚Üí G5
  playTone(523, 0.12, 'sine', 0.15, false);
  setTimeout(function(){ playTone(659, 0.12, 'sine', 0.15, false); }, 110);
  setTimeout(function(){ playTone(784, 0.22, 'sine', 0.18, true);  }, 220);
}
function playWrong() {
  // –ù–∏–∑—å–∫–∏–π —Ç—Ä–∏–≤–æ–∂–Ω–∏–π –∑–≤—É–∫
  playTone(220, 0.08, 'sawtooth', 0.1, false);
  setTimeout(function(){ playTone(196, 0.22, 'sawtooth', 0.1, true); }, 90);
}
function playHint() {
  playTone(440, 0.08, 'sine', 0.1, false);
  setTimeout(function(){ playTone(554, 0.18, 'sine', 0.1, true); }, 100);
}
function playNext() {
  playTone(392, 0.1, 'sine', 0.08, true);
}

function toggleSound() {
  soundOn = !soundOn;
  document.getElementById('soundBtn').innerHTML = soundOn ? '&#128266; –ó–≤—É–∫' : '&#128264; –ó–≤—É–∫';
}

// –ù–∞–∑–≤–∏ —Ä–∞–Ω–≥—ñ–≤ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
var RANK_LABELS = {
  legend:'üèÜ –ì–µ–Ω—ñ–π —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è',
  expert:'‚öîÔ∏è –î–æ—Å–≤—ñ–¥—á–µ–Ω–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤',
  veteran:'üîç –°–ª—ñ–¥—á–∏–π –∑ –¥–æ—Å–≤—ñ–¥–æ–º',
  student:'üìú –£—á–µ–Ω—å-–ª—ñ—Ç–æ–ø–∏—Å–µ—Ü—å',
  novice:'üïØÔ∏è –ù–æ–≤–∞—á–æ–∫ —É —Å–ø—Ä–∞–≤—ñ'
};
var RANK_ORDER = ['legend','expert','veteran','student','novice'];

function init() {
  var dots = document.getElementById('stepDots');
  dots.innerHTML = STEPS.map(function(s,i){
    return '<div class="step-dot '+(i===0?'active':'')+'" id="d'+i+'"></div>';
  }).join('');
  render();
}

function upd() {
  STEPS.forEach(function(s,i){
    var d=document.getElementById('d'+i);
    if(!d) return;
    if(i<cur) d.className='step-dot '+(results[i]?'done':'wrong');
    else if(i===cur) d.className='step-dot active';
    else d.className='step-dot';
  });
  document.getElementById('scoreBadge').textContent='–û—á–∫–∏: '+score;
  document.getElementById('progressLabel').textContent='–ö—Ä–æ–∫ '+(Math.min(cur+1,STEPS.length))+' –∑ '+STEPS.length;
}

function sHTML(s) {
  var img;
  if (s.ph && PH[s.ph]) {
    img = '<img class="suspect-photo" src="'+PH[s.ph]+'" data-emoji="'+s.e+'" onload="this.style.display=\'block\'" onerror="var d=document.createElement(\'div\');d.className=\'suspect-ph\';d.textContent=this.getAttribute(\'data-emoji\');this.parentNode.replaceChild(d,this)">';
  } else {
    img = '<div class="suspect-ph">'+s.e+'</div>';
  }
  return '<div class="suspect" data-k="'+s.k+'">'+img+
    '<div class="suspect-name">'+s.n+'</div>'+
    '<div class="suspect-role">'+s.r+'</div></div>';
}

function render() {
  upd();
  var st = STEPS[cur];
  if(st.type==='verdict'){ renderVerdict(st); return; }

  var hintPts = Math.round(st.pts * 0.3); // —à—Ç—Ä–∞—Ñ 30% –æ—á–æ–∫
  var hintDisabled = hintUsed ? 'disabled title="–ü—ñ–¥–∫–∞–∑–∫—É –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ"' : '';
  var hintLabel = hintUsed ? '&#128274; –ü—ñ–¥–∫–∞–∑–∫–∞' : '&#128161; –ü—ñ–¥–∫–∞–∑–∫–∞ (-'+hintPts+'&#160;–æ—á.)';

  var html =
    '<div class="scene-card">'+
      '<div class="scene-image-placeholder">'+st.icon+'</div>'+
      '<div class="scene-header"><div class="scene-date">'+st.date+'</div>'+
      '<div class="scene-title">'+st.title+'</div></div>'+
      '<div class="scene-body">'+st.body+'</div>'+
    '</div>'+
    '<div class="question-box">'+
      '<div class="question-text">'+st.q+'</div>'+
      '<button class="hint-btn" id="hbtn" '+hintDisabled+' onclick="useHint()">'+hintLabel+'</button>'+
    '</div>'+
    '<div class="hint-box" id="hbox"></div>'+
    '<div class="suspects-grid" id="sg">'+st.sus.map(sHTML).join('')+'</div>'+
    '<div class="feedback" id="fb"><div class="fb-title" id="ft"></div><div class="fb-text" id="fx"></div></div>'+
    '<button class="btn-next" id="bn" onclick="next()">&#8594; –î–∞–ª—ñ</button>';

  var sw = document.getElementById('sceneWrap');
  sw.classList.add('scene-entering');
  sw.innerHTML = html;
  setTimeout(function(){ sw.classList.remove('scene-entering'); }, 400);

  document.querySelectorAll('.suspect').forEach(function(el){
    el.onclick = function(){ pick(el.dataset.k, st); };
  });
}

function useHint() {
  var st = STEPS[cur];
  if(hintUsed || !st.hint) return;
  hintUsed = true;
  // –®—Ç—Ä–∞—Ñ ‚Äî –∑–Ω—ñ–º–∞—î–º–æ –æ—á–∫–∏ —è–∫—â–æ —â–µ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–ª–∏
  var hintPts = Math.round(st.pts * 0.3);
  score = Math.max(0, score - hintPts);
  document.getElementById('scoreBadge').textContent = '–û—á–∫–∏: '+score;
  // –ü–æ–∫–∞–∑—É—î–º–æ –ø—ñ–¥–∫–∞–∑–∫—É
  var hbox = document.getElementById('hbox');
  hbox.innerHTML = '&#128161; <em>–ü—ñ–¥–∫–∞–∑–∫–∞:</em> ' + st.hint + ' <span style="color:var(--red);font-size:.82rem">(-'+hintPts+' –æ—á.)</span>';
  hbox.classList.add('show');
  // –ë–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É
  var hbtn = document.getElementById('hbtn');
  if(hbtn){ hbtn.disabled = true; hbtn.innerHTML = '&#128274; –ü—ñ–¥–∫–∞–∑–∫–∞'; }
  playHint();
}

function pick(k, st) {
  document.querySelectorAll('.suspect').forEach(function(el){ el.classList.add('disabled'); el.onclick=null; });
  var ok = k===st.ck;
  score += ok ? st.pts : 0;
  results[cur] = ok;
  document.querySelectorAll('.suspect').forEach(function(el){
    if(el.dataset.k===st.ck){ el.classList.add('is-correct'); el.innerHTML+='<div class="sbadge sbadge-g">–í–∏–Ω–Ω–∏–π</div>'; }
    else if(el.dataset.k===k&&!ok){ el.classList.add('is-wrong'); el.innerHTML+='<div class="sbadge sbadge-i">&#x2717;</div>'; }
  });
  var fb=document.getElementById('fb');
  fb.className='feedback show '+(ok?'ok':'bad');
  document.getElementById('ft').textContent=(ok?'‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! +'+st.pts+' –æ—á–∫—ñ–≤':'‚úó –ù–µ –≤—ñ—Ä–Ω–æ');
  document.getElementById('fx').textContent=(ok?st.fok:st.fno);
  var bn=document.getElementById('bn'); bn.classList.add('show');
  bn.textContent=cur<STEPS.length-1?'–î–∞–ª—ñ ‚Üí':'–§—ñ–Ω–∞–ª—å–Ω–∏–π –≤–µ—Ä–¥–∏–∫—Ç ‚öñ';
  document.getElementById('scoreBadge').textContent='–û—á–∫–∏: '+score;
  // –ó–≤—É–∫
  if(ok) playCorrect(); else playWrong();
}

function next() {
  var sw = document.getElementById('sceneWrap');
  sw.classList.add('scene-exiting');
  playNext();
  setTimeout(function(){
    sw.classList.remove('scene-exiting');
    cur++;
    if(cur>=STEPS.length){ showResult(); return; }
    render();
    window.scrollTo({top:0,behavior:'smooth'});
  }, 230);
}

function renderVerdict(st) {
  var sel=[];
  document.getElementById('sceneWrap').innerHTML=
    '<div class="scene-card">'+
      '<div class="scene-image-placeholder">‚öñÔ∏è</div>'+
      '<div class="scene-header"><div class="scene-date">–§—ñ–Ω–∞–ª—å–Ω–∏–π –≤–µ—Ä–¥–∏–∫—Ç</div>'+
      '<div class="scene-title">'+st.q+'</div></div>'+
      '<div class="scene-body">–û–±–µ—Ä–∏ <strong>–æ–¥–Ω–æ–≥–æ –∞–±–æ –¥–≤–æ—Ö</strong> –ø—ñ–¥–æ–∑—Ä—é–≤–∞–Ω–∏—Ö.</div>'+
    '</div>'+
    '<div class="suspects-grid" id="sg">'+st.sus.map(sHTML).join('')+'</div>'+
    '<div class="feedback" id="fb"><div class="fb-title" id="ft"></div><div class="fb-text" id="fx"></div></div>'+
    '<button class="btn-next show" id="bn">–û–≥–æ–ª–æ—Å–∏—Ç–∏ –≤–∏—Ä–æ–∫ ‚öñ</button>';
  document.querySelectorAll('.suspect').forEach(function(el){
    el.onclick=function(){
      var k=el.dataset.k, i=sel.indexOf(k);
      if(i>=0){sel.splice(i,1);el.classList.remove('selected');}
      else{sel.push(k);el.classList.add('selected');}
    };
  });
  document.getElementById('bn').onclick=function(){ finalV(st,sel); };
}

function finalV(st,sel) {
  var allOk=st.cks.every(function(k){return sel.indexOf(k)>=0;})&&sel.length===st.cks.length;
  var part=!allOk&&st.cks.some(function(k){return sel.indexOf(k)>=0;});
  var earn=allOk?st.pts:part?Math.floor(st.pts/2):0;
  score+=earn; results[cur]=allOk;
  document.querySelectorAll('.suspect').forEach(function(el){
    var k=el.dataset.k;
    if(st.cks.indexOf(k)>=0){el.classList.add('is-correct');el.innerHTML+='<div class="sbadge sbadge-g">–í–∏–Ω–Ω–∏–π</div>';}
    else if(sel.indexOf(k)>=0){el.classList.add('is-wrong');}
    el.classList.add('disabled'); el.onclick=null;
  });
  var fb=document.getElementById('fb');
  fb.className='feedback show '+(allOk?'ok':'bad');
  document.getElementById('ft').textContent=allOk?'‚úì –ë–µ–∑–¥–æ–≥–∞–Ω–Ω–æ! +'+st.pts+' –æ—á–∫—ñ–≤':part?'‚ö† –ß–∞—Å—Ç–∫–æ–≤–æ! +'+earn+' –æ—á–∫—ñ–≤':'‚úó –ù–µ –≤—ñ—Ä–Ω–æ';
  document.getElementById('fx').textContent=allOk?st.fok:part?st.fpart:st.fno;
  document.getElementById('scoreBadge').textContent='–û—á–∫–∏: '+score;
  var bn=document.getElementById('bn'); bn.textContent='–ü–æ–±–∞—á–∏—Ç–∏ –ø—ñ–¥—Å—É–º–æ–∫ ‚Üí'; bn.onclick=showResult;
}

function buildStatsHTML(st, currentRank) {
  var total = st.total + 1; // +1 –±–æ —â–æ–π–Ω–æ –∑—ñ–≥—Ä–∞–ª–∏
  if(total < 1) return '';
  var ranks = st.ranks || {};
  // –î–æ–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  var display = {};
  RANK_ORDER.forEach(function(r){ display[r] = (ranks[r]||0); });
  display[currentRank] = (display[currentRank]||0) + 1;

  var maxVal = 0;
  RANK_ORDER.forEach(function(r){ if(display[r]>maxVal) maxVal=display[r]; });
  if(maxVal===0) maxVal=1;

  var rows = RANK_ORDER.map(function(r){
    var cnt = display[r];
    var pct = Math.round(cnt/total*100);
    var barW = Math.round(cnt/maxVal*100);
    return '<div class="stat-row">'+
      '<div class="stat-label">'+RANK_LABELS[r]+'</div>'+
      '<div class="stat-bar-wrap"><div class="stat-bar" style="width:'+barW+'%"></div></div>'+
      '<div class="stat-count">'+cnt+'</div>'+
      '<div class="stat-pct">'+pct+'%</div>'+
    '</div>';
  }).join('');

  return '<div class="stats-box">'+
    '<div class="stats-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞–≤—Ü—ñ–≤</div>'+
    '<div class="stats-total">–£—Å—å–æ–≥–æ —ñ–≥–æ—Ä: <span>'+total+'</span></div>'+
    '<div class="stats-ranks">'+rows+'</div>'+
  '</div>';
}

function showResult() {
  // –ù–∞–¥—Å–∏–ª–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  var mx=STEPS.reduce(function(s,st){return s+(st.pts||0);},0);
  var pct=Math.round(score/mx*100), cor=results.filter(Boolean).length;
  var icon,title,desc,rankSlug;
  if(pct>=80){
    rankSlug='legend'; icon='üèÜ';
    title='–ì–µ–Ω—ñ–π —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è!';
    desc='–ë–µ–∑–¥–æ–≥–∞–Ω–Ω–æ. –¢–∏ —Ä–æ–∑–∫—Ä–∏–≤ –∑–ª–æ—á–∏–Ω XI —Å—Ç. —Ç–∞–∫ —Ç–æ—á–Ω–æ, —è–∫ –Ω—ñ–±–∏ —Å–∞–º —á–∏—Ç–∞–≤ –ü–æ–≤—ñ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–∏—Ö –ª—ñ—Ç. –£—Å—ñ –¥–æ–∫–∞–∑–∏ —ñ –∑–≤\'—è–∑–∫–∏ ‚Äî —Ç–∏ –ø–æ–±–∞—á–∏–≤ —É—Å–µ.';
  } else if(pct>=60){
    rankSlug='expert'; icon='‚öîÔ∏è';
    title='–î–æ—Å–≤—ñ–¥—á–µ–Ω–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤';
    desc='–ß—É–¥–æ–≤–∞ —Ä–æ–±–æ—Ç–∞! –ë—ñ–ª—å—à—ñ—Å—Ç—å –¥–µ—Ç–∞–ª–µ–π —Ä–æ–∑–∫—Ä–∏—Ç–æ –≤—ñ—Ä–Ω–æ. –ó–æ–≤—Å—ñ–º –Ω–µ–±–∞–≥–∞—Ç–æ –≤–∏—Å–ª–∏–∑–Ω—É–ª–æ –≤—ñ–¥ —Ç–≤–æ–≥–æ –ø–æ–≥–ª—è–¥—É.';
  } else if(pct>=40){
    rankSlug='veteran'; icon='üîç';
    title='–°–ª—ñ–¥—á–∏–π –∑ –¥–æ—Å–≤—ñ–¥–æ–º';
    desc='–ó–∞–≥–∞–ª—å–Ω—É –∫–∞—Ä—Ç–∏–Ω—É –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∞–ª–µ –∫—ñ–ª—å–∫–∞ –∫–ª—é—á–æ–≤–∏—Ö –¥–µ—Ç–∞–ª–µ–π –∑–∞–ª–∏—à–∏–ª–∏—Å—å –Ω–µ—Ä–æ–∑–∫—Ä–∏—Ç–∏–º–∏.';
  } else if(pct>=20){
    rankSlug='student'; icon='üìú';
    title='–£—á–µ–Ω—å-–ª—ñ—Ç–æ–ø–∏—Å–µ—Ü—å';
    desc='–î–µ—è–∫—ñ —ñ–Ω—Ç—Ä–∏–≥–∏ –≤–∏—è–≤–∏–ª–∏—Å—å –∑–∞–ø–ª—É—Ç–∞–Ω—ñ—à–∏–º–∏, –Ω—ñ–∂ –∑–¥–∞–≤–∞–ª–æ—Å—å. –ê–ª–µ —Ç–µ–ø–µ—Ä —Ç–∏ –∑–Ω–∞—î—à –ø—Ä–∞–≤–¥—É! –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.';
  } else {
    rankSlug='novice'; icon='üïØÔ∏è';
    title='–ù–æ–≤–∞—á–æ–∫ —É —Å–ø—Ä–∞–≤—ñ';
    desc='–ó–ª–æ—á–∏–Ω XI —Å—Ç. –≤–∏—è–≤–∏–≤—Å—è –∑–∞–ø–ª—É—Ç–∞–Ω–∏–º. –í–∏–≤—á–∏ —Ñ–∞–∫—Ç–∏ —ñ —Å–ø—Ä–æ–±—É–π –∑–Ω–æ–≤—É ‚Äî –ø—Ä–∞–≤–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–æ–∂–Ω–æ–º—É!';
  }

  // AJAX ‚Äî –∑–∞–ø–∏—Å—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  var xhr = new XMLHttpRequest();
  xhr.open('POST', BASE_URL+'/track.php', true);
  xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
  xhr.send('r='+rankSlug+'&s='+score+'&c='+cor);

  SD.url = BASE_URL+'/result.php?r='+rankSlug+'&s='+score+'&c='+cor;
  SD.text = icon+' '+title+'\n'+score+'/'+mx+' –æ—á–∫—ñ–≤ —É –≥—Ä—ñ ¬´–û—Å–ª—ñ–ø–ª–µ–Ω–Ω—è –í–∞—Å–∏–ª—å–∫–∞ 1097¬ª\n–•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ –∑–ª–æ—á–∏–Ω–æ–º XI —Å—Ç.? –°–ø—Ä–æ–±—É–π:';

  document.getElementById('sceneWrap').style.display='none';
  var vw=document.getElementById('verdictWrap'); vw.style.display='block';
  vw.innerHTML=
    '<div class="verdict-card">'+
      '<div class="verdict-icon">'+icon+'</div>'+
      '<div class="verdict-title">'+title+'</div>'+
      '<div class="verdict-score">'+score+' / '+mx+' –æ—á–∫—ñ–≤ &middot; '+cor+'/'+STEPS.length+' –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö</div>'+
      '<div class="verdict-desc">'+desc+'</div>'+
      buildStatsHTML(SERVER_STATS, rankSlug)+
      '<div class="share-wrap">'+
        '<div class="share-lbl">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º</div>'+
        '<div class="share-preview" id="sprev"></div>'+
        '<div class="share-btns">'+
          '<button class="sbtn sbtn-tw" onclick="doShare(\'tw\')">ùïè Twitter&nbsp;/&nbsp;X</button>'+
          '<button class="sbtn sbtn-fb" onclick="doShare(\'fb\')">f Facebook</button>'+
          '<button class="sbtn sbtn-tg" onclick="doShare(\'tg\')">‚úà Telegram</button>'+
          '<button class="sbtn sbtn-vi" onclick="doShare(\'vi\')">üì≤ Viber</button>'+
          '<button class="sbtn sbtn-cp" id="cpb" onclick="doCopy(this)">üîó –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button>'+
        '</div>'+
      '</div>'+
      '<div class="history-box">'+
        '<div class="history-title">üìú –©–æ —Å—Ç–∞–ª–æ—Å—å –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ</div>'+
        '<div class="history-text">'+
          '<strong>–õ–∏—Å—Ç–æ–ø–∞–¥ 1097 —Ä.</strong> ‚Äî –õ—é–±–µ—Ü—å–∫–∏–π –∑\'—ó–∑–¥. –í–∞—Å–∏–ª—å–∫—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –¢–µ—Ä–µ–±–æ–≤–ª—é.<br>'+
          '<strong>5 –≥—Ä—É–¥–Ω—è 1097 —Ä.</strong> ‚Äî –°–≤—è—Ç–æ–ø–æ–ª–∫ –∑–∞–∞—Ä–µ—à—Ç–æ–≤—É—î –í–∞—Å–∏–ª—å–∫–∞.<br>'+
          '<strong>–ì—Ä—É–¥–µ–Ω—å 1097 —Ä.</strong> ‚Äî –õ—é–¥–∏ –î–∞–≤–∏–¥–∞ –æ—Å–ª—ñ–ø–ª—é—é—Ç—å –í–∞—Å–∏–ª—å–∫–∞ –ø–æ–±–ª–∏–∑—É –ó–≤–µ–Ω–∏–≥–æ—Ä–æ–¥–∞.<br>'+
          '<strong>1098 —Ä.</strong> ‚Äî –ú–æ–Ω–æ–º–∞—Ö –∑–∞—Å—É–¥–∂—É—î –∑–ª–æ—á–∏–Ω. –í–æ–ª–æ–¥–∞—Ä –≤–∏–∑–≤–æ–ª—è—î –±—Ä–∞—Ç–∞.<br>'+
          '<strong>1099 —Ä.</strong> ‚Äî –í–∞—Å–∏–ª—å–∫–æ —ñ –í–æ–ª–æ–¥–∞—Ä –Ω–∞ –†–æ–∂–Ω–æ–º—É –ø–æ–ª—ñ —Ä–æ–∑–±–∏–≤–∞—é—Ç—å –∞—Ä–º—ñ—é –°–≤—è—Ç–æ–ø–æ–ª–∫–∞.<br>'+
          '<strong>1100 —Ä.</strong> ‚Äî –ó\'—ó–∑–¥ –≤ –£–≤–µ—Ç–∏—á–∞—Ö: –î–∞–≤–∏–¥ –ø–æ–∑–±–∞–≤–ª–µ–Ω–∏–π –í–æ–ª–∏–Ω—ñ.<br>'+
          '<strong>1122 —Ä.</strong> ‚Äî –í–∞—Å–∏–ª—å–∫–æ –∑–∞ 20 000 –≥—Ä–∏–≤–µ–Ω—å –≤–∏–∫—É–ø–æ–≤—É—î –±—Ä–∞—Ç–∞ –∑ –ø–æ–ª—å—Å—å–∫–æ–≥–æ –ø–æ–ª–æ–Ω—É.<br>'+
          '<strong>28 –ª—é—Ç–æ–≥–æ 1124 —Ä.</strong> ‚Äî –í–∞—Å–∏–ª—å–∫–æ –ø–æ–º–∏—Ä–∞—î —É –¢–µ—Ä–µ–±–æ–≤–ª—ñ. –ü—Ä–∞–≤–∏–≤ 39 —Ä–æ–∫—ñ–≤.'+
        '</div>'+
      '</div>'+
      '<button class="btn-replay" onclick="replay()">‚Ü∫ –ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É</button>'+
    '</div>';
  document.getElementById('sprev').textContent = SD.text + '\n' + SD.url;
  window.scrollTo({top:0,behavior:'smooth'});
}

function doShare(t) {
  var te=encodeURIComponent(SD.text+'\n'+SD.url), ue=encodeURIComponent(SD.url), me=encodeURIComponent(SD.text);
  if(t==='fb'){
    var txt=SD.text+'\n'+SD.url;
    function openFB(){window.open('https://www.facebook.com/sharer/sharer.php?u='+ue,'_blank','width=640,height=460,noopener,noreferrer');}
    if(navigator.clipboard&&navigator.clipboard.writeText){
      navigator.clipboard.writeText(txt).then(function(){
        var btn=document.querySelector('.sbtn-fb');
        var orig=btn.innerHTML; btn.innerHTML='‚úì –¢–µ–∫—Å—Ç —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! –í—Å—Ç–∞–≤—Ç–µ —É –ø–æ—Å—Ç';
        setTimeout(function(){btn.innerHTML=orig;},3000);
        setTimeout(openFB,400);
      }).catch(openFB);
    } else { openFB(); }
    return;
  }
  var map={
    tw:'https://twitter.com/intent/tweet?text='+te,
    tg:'https://t.me/share/url?url='+ue+'&text='+me,
    vi:'viber://forward?text='+te
  };
  if(map[t]) window.open(map[t],'_blank','width=640,height=460,noopener,noreferrer');
}

function doCopy(btn) {
  var txt=SD.text+'\n'+SD.url;
  function ok(){btn.textContent='‚úì –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';btn.classList.add('copied');setTimeout(function(){btn.textContent='üîó –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏';btn.classList.remove('copied');},2500);}
  if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(txt).then(ok).catch(fallback);}
  else{fallback();}
  function fallback(){var ta=document.createElement('textarea');ta.value=txt;ta.style.cssText='position:fixed;opacity:0;top:0;left:0;';document.body.appendChild(ta);ta.focus();ta.select();try{document.execCommand('copy');ok();}catch(e){}document.body.removeChild(ta);}
}

function replay(){
  cur=0; score=0; results=[]; hintUsed=false;
  document.getElementById('verdictWrap').style.display='none';
  document.getElementById('sceneWrap').style.display='block';
  init();
}

// ===== –¢–ï–ú–ê =====
function toggleTheme() {
  var isLight = document.body.classList.toggle('light');
  document.getElementById('theme-lbl').textContent = isLight ? '–¢–µ–º–Ω–∞' : '–°–≤—ñ—Ç–ª–∞';
  document.querySelector('.theme-toggle .icon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
  try { localStorage.setItem('vasylko-theme', isLight ? 'light' : 'dark'); } catch(e){}
}
(function(){
  try {
    if(localStorage.getItem('vasylko-theme')==='light'){
      document.body.classList.add('light');
      window.addEventListener('load', function(){
        var lbl=document.getElementById('theme-lbl');
        var ico=document.querySelector('.theme-toggle .icon');
        if(lbl) lbl.textContent='–¢–µ–º–Ω–∞';
        if(ico) ico.textContent='‚òÄÔ∏è';
      });
    }
  } catch(e){}
})();

// ===== –°–¢–ê–†–¢ =====
var gameStarted = false;
function startGame() {
  document.getElementById('startBlock').style.display = 'none';
  document.getElementById('progressWrap').style.display = 'flex';
  document.getElementById('sceneWrap').style.display = 'block';
  if(!gameStarted){ gameStarted=true; cur=0; score=0; results=[]; init(); }
}

// ===== –ü–û–®–ò–†–ï–ù–ù–Ø –ì–†–ò –ó –ì–û–õ–û–í–ù–û–á =====
var GAME_URL  = BASE_URL + '/index.php';
var GAME_TEXT = '–û—Å–ª—ñ–ø–ª–µ–Ω–Ω—è –í–∞—Å–∏–ª—å–∫–∞ 1097 ‚Äî –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞. –•—Ç–æ —Å—Ç–æ—ó—Ç—å –∑–∞ –∑–ª–æ—á–∏–Ω–æ–º XI —Å—Ç.? –°–ø—Ä–æ–±—É–π:';

function shareGame(t) {
  var te=encodeURIComponent(GAME_TEXT+'\n'+GAME_URL);
  var ue=encodeURIComponent(GAME_URL);
  var me=encodeURIComponent(GAME_TEXT);
  if(t==='fb'){
    var txt=GAME_TEXT+'\n'+GAME_URL;
    function openFB(){ window.open('https://www.facebook.com/sharer/sharer.php?u='+ue,'_blank','width=640,height=460,noopener'); }
    if(navigator.clipboard&&navigator.clipboard.writeText){
      navigator.clipboard.writeText(txt).then(function(){
        var b=document.querySelector('#startShare .sbtn-fb');
        if(b){var o=b.innerHTML;b.innerHTML='&#10003; –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';setTimeout(function(){b.innerHTML=o;},2500);}
        setTimeout(openFB,400);
      }).catch(openFB);
    } else { openFB(); }
    return;
  }
  var map={
    tw:'https://twitter.com/intent/tweet?text='+te,
    tg:'https://t.me/share/url?url='+ue+'&text='+me,
    vi:'viber://forward?text='+te
  };
  if(map[t]) window.open(map[t],'_blank','width=640,height=460,noopener');
}

function copyGame(btn) {
  var txt=GAME_TEXT+'\n'+GAME_URL;
  function ok(){btn.textContent='–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!';btn.classList.add('copied');setTimeout(function(){btn.textContent='–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏';btn.classList.remove('copied');},2500);}
  if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(txt).then(ok);}
  else{var ta=document.createElement('textarea');ta.value=txt;document.body.appendChild(ta);ta.select();try{document.execCommand('copy');ok();}catch(e){}document.body.removeChild(ta);}
}

</script>
</body>
</html>
